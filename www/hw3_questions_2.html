<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.506">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sangho Lee">
<meta name="dcterms.date" content="2024-05-15">

<title>hw3_questions_2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="hw3_questions_2_files/libs/clipboard/clipboard.min.js"></script>
<script src="hw3_questions_2_files/libs/quarto-html/quarto.js"></script>
<script src="hw3_questions_2_files/libs/quarto-html/popper.min.js"></script>
<script src="hw3_questions_2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="hw3_questions_2_files/libs/quarto-html/anchor.min.js"></script>
<link href="hw3_questions_2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="hw3_questions_2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="hw3_questions_2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="hw3_questions_2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="hw3_questions_2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Sangho Lee </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 15, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="estimating-minivan-consumer-preferences" class="level2">
<h2 class="anchored" data-anchor-id="estimating-minivan-consumer-preferences">1. Estimating Minivan Consumer Preferences</h2>
<section id="likelihood-for-the-multi-nomial-logit-mnl-model" class="level3">
<h3 class="anchored" data-anchor-id="likelihood-for-the-multi-nomial-logit-mnl-model">Likelihood for the Multi-nomial Logit (MNL) Model</h3>
<p>Suppose we have <span class="math inline">\(i=1,\ldots,n\)</span> consumers who each select exactly one product <span class="math inline">\(j\)</span> from a set of <span class="math inline">\(J\)</span> products. The outcome variable is the identity of the product chosen <span class="math inline">\(y_i \in \{1, \ldots, J\}\)</span> or equivalently a vector of <span class="math inline">\(J-1\)</span> zeros and <span class="math inline">\(1\)</span> one, where the <span class="math inline">\(1\)</span> indicates the selected product. For example, if the third product was chosen out of 4 products, then either <span class="math inline">\(y=3\)</span> or <span class="math inline">\(y=(0,0,1,0)\)</span> depending on how we want to represent it. Suppose also that we have a vector of data on each product <span class="math inline">\(x_j\)</span> (eg, size, price, etc.).</p>
<p>We model the consumer’s decision as the selection of the product that provides the most utility, and we’ll specify the utility function as a linear function of the product characteristics:</p>
<p><span class="math display">\[ U_{ij} = x_j'\beta + \epsilon_{ij} \]</span></p>
<p>where <span class="math inline">\(\epsilon_{ij}\)</span> is an i.i.d. extreme value error term.</p>
<p>The choice of the i.i.d. extreme value error term leads to a closed-form expression for the probability that consumer <span class="math inline">\(i\)</span> chooses product <span class="math inline">\(j\)</span>:</p>
<p><span class="math display">\[ \mathbb{P}_i(j) = \frac{e^{x_j'\beta}}{\sum_{k=1}^Je^{x_k'\beta}} \]</span></p>
<p>For example, if there are 4 products, the probability that consumer <span class="math inline">\(i\)</span> chooses product 3 is:</p>
<p><span class="math display">\[ \mathbb{P}_i(3) = \frac{e^{x_3'\beta}}{e^{x_1'\beta} + e^{x_2'\beta} + e^{x_3'\beta} + e^{x_4'\beta}} \]</span></p>
<p>A clever way to write the individual likelihood function for consumer <span class="math inline">\(i\)</span> is the product of the <span class="math inline">\(J\)</span> probabilities, each raised to the power of an indicator variable (<span class="math inline">\(\delta_{ij}\)</span>) that indicates the chosen product:</p>
<p><span class="math display">\[ L_i(\beta) = \prod_{j=1}^J \mathbb{P}_i(j)^{\delta_{ij}} = \mathbb{P}_i(1)^{\delta_{i1}} \times \ldots \times \mathbb{P}_i(J)^{\delta_{iJ}}\]</span></p>
<p>Notice that if the consumer selected product <span class="math inline">\(j=3\)</span>, then <span class="math inline">\(\delta_{i3}=1\)</span> while <span class="math inline">\(\delta_{i1}=\delta_{i2}=\delta_{i4}=0\)</span> and the likelihood is:</p>
<p><span class="math display">\[ L_i(\beta) = \mathbb{P}_i(1)^0 \times \mathbb{P}_i(2)^0 \times \mathbb{P}_i(3)^1 \times \mathbb{P}_i(4)^0 = \mathbb{P}_i(3) = \frac{e^{x_3'\beta}}{\sum_{k=1}^Je^{x_k'\beta}} \]</span></p>
<p>The joint likelihood (across all consumers) is the product of the <span class="math inline">\(n\)</span> individual likelihoods:</p>
<p><span class="math display">\[ L_n(\beta) = \prod_{i=1}^n L_i(\beta) = \prod_{i=1}^n \prod_{j=1}^J \mathbb{P}_i(j)^{\delta_{ij}} \]</span></p>
<p>And the joint log-likelihood function is:</p>
<p><span class="math display">\[ \ell_n(\beta) = \sum_{i=1}^n \sum_{j=1}^J \delta_{ij} \log(\mathbb{P}_i(j)) \]</span></p>
</section>
</section>
<section id="estimating-minivan-preferences" class="level2">
<h2 class="anchored" data-anchor-id="estimating-minivan-preferences">Estimating Minivan Preferences</h2>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
</section>
<section id="i-will-provide-a-detailed-description-of-the-dataset-derived-from-a-conjoint-survey.-this-will-include-specifying-the-number-of-respondents-who-participated-in-the-survey-the-number-of-choice-tasks-each-respondent-completed-and-the-number-of-alternatives-presented-in-each-choice-task.-additionally-i-will-outline-the-attributes-and-their-levels-used-in-the-survey-number-of-seats-6-7-8-cargo-space-2ft-3ft-engine-type-gas-hybrid-electric-and-price-in-thousands-of-dollars." class="level3">
<h3 class="anchored" data-anchor-id="i-will-provide-a-detailed-description-of-the-dataset-derived-from-a-conjoint-survey.-this-will-include-specifying-the-number-of-respondents-who-participated-in-the-survey-the-number-of-choice-tasks-each-respondent-completed-and-the-number-of-alternatives-presented-in-each-choice-task.-additionally-i-will-outline-the-attributes-and-their-levels-used-in-the-survey-number-of-seats-6-7-8-cargo-space-2ft-3ft-engine-type-gas-hybrid-electric-and-price-in-thousands-of-dollars.">I will provide a detailed description of the dataset derived from a conjoint survey. This will include specifying the number of respondents who participated in the survey, the number of choice tasks each respondent completed, and the number of alternatives presented in each choice task. Additionally, I will outline the attributes and their levels used in the survey: number of seats (6, 7, 8), cargo space (2ft, 3ft), engine type (gas, hybrid, electric), and price (in thousands of dollars).</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyrsm <span class="im">as</span> rsm</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>minivan_data <span class="op">=</span> pd.read_csv(<span class="st">"rintro-chapter13conjoint.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stats)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nnet)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlogit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>minivan_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"rintro-chapter13conjoint.csv"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>minivan_data <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">resp.id</th>
<th style="text-align: right;">ques</th>
<th style="text-align: right;">alt</th>
<th style="text-align: left;">carpool</th>
<th style="text-align: right;">seat</th>
<th style="text-align: left;">cargo</th>
<th style="text-align: left;">eng</th>
<th style="text-align: right;">price</th>
<th style="text-align: right;">choice</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">2ft</td>
<td style="text-align: left;">gas</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">3ft</td>
<td style="text-align: left;">hyb</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">3ft</td>
<td style="text-align: left;">gas</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">2ft</td>
<td style="text-align: left;">gas</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">3ft</td>
<td style="text-align: left;">gas</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">2ft</td>
<td style="text-align: left;">elec</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">3ft</td>
<td style="text-align: left;">gas</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">3ft</td>
<td style="text-align: left;">elec</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">2ft</td>
<td style="text-align: left;">elec</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">3ft</td>
<td style="text-align: left;">elec</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="data-explanation" class="level3">
<h3 class="anchored" data-anchor-id="data-explanation">Data Explanation</h3>
<ul>
<li>resp.id: The ID of the respondent.</li>
<li>ques: The question number within the survey.</li>
<li>alt: The alternative choice number within each question.</li>
<li>carpool: Indicates if the respondent is considering carpooling (“yes” or “no”).</li>
<li>seat: The number of seats in the minivan (6, 7, or 8).</li>
<li>cargo: The cargo space in the minivan (2ft or 3ft).</li>
<li>eng: The type of engine (gas, hybrid, or electric).</li>
<li>price: The price of the minivan in thousands of dollars.</li>
<li>choice: The respondent’s choice indicator (1 if the alternative was chosen, 0 otherwise).</li>
</ul>
<p>The attributes (levels) were number of seats (6,7,8), cargo space (2ft, 3ft), engine type (gas, hybrid, electric), and price (in thousands of dollars).</p>
</section>
<section id="eda" class="level3">
<h3 class="anchored" data-anchor-id="eda">EDA</h3>
<p>I will perform exploratory data analysis (EDA) to understand the format and characteristics of the dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="op">=</span> minivan_data[[<span class="st">'seat'</span>, <span class="st">'price'</span>, <span class="st">'choice'</span>]].describe()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>summary_stats_df <span class="op">=</span> summary_stats.T.reset_index()</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>summary_stats_df.columns <span class="op">=</span> [<span class="st">'Variable'</span>, <span class="st">'Count'</span>, <span class="st">'Mean'</span>, <span class="st">'Std'</span>, <span class="st">'Min'</span>, <span class="st">'25%'</span>, <span class="st">'50%'</span>, <span class="st">'75%'</span>, <span class="st">'Max'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>print_table(summary_stats_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>| Variable   |      Count |       Mean |        Std |    Min |    25% |    50% |    75% |    Max |
|------------|------------|------------|------------|--------|--------|--------|--------|--------|
| seat       |     9000.0 |    6.99544 |    0.81701 |    6.0 |    6.0 |    7.0 |    8.0 |    8.0 |
| price      |     9000.0 |   35.00389 |    4.08373 |   30.0 |   30.0 |   35.0 |   40.0 |   40.0 |
| choice     |     9000.0 |    0.33333 |    0.47143 |    0.0 |    0.0 |    0.0 |    1.0 |    1.0 |</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>summary_stats_melted <span class="op">=</span> summary_stats_df.melt(id_vars<span class="op">=</span><span class="st">'Variable'</span>, value_vars<span class="op">=</span>[<span class="st">'Mean'</span>, <span class="st">'Std'</span>, <span class="st">'Min'</span>, <span class="st">'25%'</span>, <span class="st">'50%'</span>, <span class="st">'75%'</span>, <span class="st">'Max'</span>])</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="st">'variable'</span>, y<span class="op">=</span><span class="st">'value'</span>, hue<span class="op">=</span><span class="st">'Variable'</span>, data<span class="op">=</span>summary_stats_melted)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Summary Statistics of Numerical Variables'</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Statistics'</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Values'</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw3_questions_2_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interpretation-of-this-plot" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-of-this-plot">Interpretation of this plot</h3>
<section id="mean" class="level4">
<h4 class="anchored" data-anchor-id="mean">Mean</h4>
<ul>
<li>Seat: The average number of seats is close to 7.</li>
<li>Price: The average price is around $35,000.</li>
<li>Choice: The average choice value is 0.333, indicating that about 33% of the alternatives were chosen.</li>
</ul>
</section>
<section id="standard-deviation-std" class="level4">
<h4 class="anchored" data-anchor-id="standard-deviation-std">Standard Deviation (Std)</h4>
<ul>
<li>Seat: The variability in the number of seats is relatively low.</li>
<li>Price: The variability in price is moderate.</li>
<li>Choice: The variability in choices is relatively low.</li>
</ul>
</section>
<section id="minimum" class="level4">
<h4 class="anchored" data-anchor-id="minimum">Minimum</h4>
<ul>
<li>Seat: The minimum number of seats is 6.</li>
<li>Price: The minimum price is $30,000.</li>
<li>Choice: The minimum choice value is 0 (indicating not chosen, it doesn’t mean anything here).</li>
</ul>
</section>
<section id="th-percentile-25" class="level4">
<h4 class="anchored" data-anchor-id="th-percentile-25">25th Percentile (25%)</h4>
<ul>
<li>Seat: 25% of the minivans have 6 seats.</li>
<li>Price: 25% of the prices are $30,000.</li>
<li>Choice: 25% of the observations have a choice value of 0 (not chosen).</li>
</ul>
</section>
<section id="th-percentile-median-or-50" class="level4">
<h4 class="anchored" data-anchor-id="th-percentile-median-or-50">50th Percentile (Median or 50%)</h4>
<ul>
<li>Seat: The median number of seats is 7.</li>
<li>Price: The median price is $35,000.</li>
<li>Choice: The median choice value is 0 (indicating that most choices are not chosen).</li>
</ul>
</section>
<section id="th-percentile-75" class="level4">
<h4 class="anchored" data-anchor-id="th-percentile-75">75th Percentile (75%)</h4>
<ul>
<li>Seat: 75% of the minivans have at least 7 seats.</li>
<li>Price: 75% of the prices are $40,000 or less.</li>
<li>Choice: 75% of the observations have a choice value of 1 (indicating chosen).</li>
</ul>
</section>
<section id="maximum" class="level4">
<h4 class="anchored" data-anchor-id="maximum">Maximum</h4>
<ul>
<li>Seat: The maximum number of seats is 8.</li>
<li>Price: The maximum price is $40,000.</li>
<li>Choice: The maximum choice value is 1 (indicating chosen).</li>
</ul>
</section>
<section id="overall-insights" class="level4">
<h4 class="anchored" data-anchor-id="overall-insights">Overall Insights</h4>
<ul>
<li>Seats and Price: Both seat and price show a consistent distribution, with most minivans having 6 to 8 seats and prices ranging from $30,000 to $40,000.</li>
<li>Choice: The choice variable is binary (0 or 1) with a third of the observations being chosen, indicating some preferences among the alternatives.</li>
</ul>
<p><br><br></p>
</section>
</section>
<section id="model" class="level3">
<h3 class="anchored" data-anchor-id="model">Model</h3>
</section>
<section id="i-will-estimate-a-multinomial-logit-mnl-model-while-omitting-certain-levels-to-avoid-multicollinearity-specifically-the-base-levels-for-number-of-seats-6-seats-cargo-space-2ft-and-engine-type-gas-engine.-price-will-be-included-as-a-continuous-variable-in-the-model.-the-estimation-can-be-performed-using-a-custom-likelihood-function-previously-defined-in-the-yogurt-project" class="level3">
<h3 class="anchored" data-anchor-id="i-will-estimate-a-multinomial-logit-mnl-model-while-omitting-certain-levels-to-avoid-multicollinearity-specifically-the-base-levels-for-number-of-seats-6-seats-cargo-space-2ft-and-engine-type-gas-engine.-price-will-be-included-as-a-continuous-variable-in-the-model.-the-estimation-can-be-performed-using-a-custom-likelihood-function-previously-defined-in-the-yogurt-project">I will estimate a Multinomial Logit (MNL) model while omitting certain levels to avoid multicollinearity: specifically, the base levels for ‘number of seats’ (6 seats), ‘cargo space’ (2ft), and ‘engine type’ (gas engine). Price will be included as a continuous variable in the model. The estimation can be performed using a custom likelihood function previously defined in the “Yogurt” Project!</h3>
</section>
<section id="the-challenging-aspect-of-the-mnl-likelihood-function-is-organizing-the-minivan-data-as-we-need-to-account-for-three-dimensions-consumer-covariate-and-minivan-option-instead-of-the-typical-two-dimensions-for-cross-sectional-regression-models-consumer-and-covariate." class="level3">
<h3 class="anchored" data-anchor-id="the-challenging-aspect-of-the-mnl-likelihood-function-is-organizing-the-minivan-data-as-we-need-to-account-for-three-dimensions-consumer-covariate-and-minivan-option-instead-of-the-typical-two-dimensions-for-cross-sectional-regression-models-consumer-and-covariate.">The challenging aspect of the MNL likelihood function is organizing the minivan data, as we need to account for three dimensions: consumer, covariate, and minivan option, instead of the typical two dimensions for cross-sectional regression models (consumer and covariate).</h3>
</section>
<section id="our-goal-is-to-reorganize-the-minivan-data-from-a-wide-format-with-multiple-columns-for-each-covariate-into-a-long-format-with-a-single-column-for-each-covariate.-during-this-reorganization-well-add-binary-variables-to-indicate-the-first-three-minivan-options.-the-variables-for-carpool-seat-cargo-engine-type-and-price-are-included-in-the-dataset-and-simply-need-to-be-pivoted-or-melted-from-wide-to-long-format." class="level3">
<h3 class="anchored" data-anchor-id="our-goal-is-to-reorganize-the-minivan-data-from-a-wide-format-with-multiple-columns-for-each-covariate-into-a-long-format-with-a-single-column-for-each-covariate.-during-this-reorganization-well-add-binary-variables-to-indicate-the-first-three-minivan-options.-the-variables-for-carpool-seat-cargo-engine-type-and-price-are-included-in-the-dataset-and-simply-need-to-be-pivoted-or-melted-from-wide-to-long-format.">Our goal is to reorganize the minivan data from a “wide” format with multiple columns for each covariate into a “long” format with a single column for each covariate. During this reorganization, we’ll add binary variables to indicate the first three minivan options. The variables for carpool, seat, cargo, engine type, and price are included in the dataset and simply need to be “pivoted” or “melted” from wide to long format.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape the data from wide to long format</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>minivan_long <span class="ot">&lt;-</span> minivan_data <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"price"</span>),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"attribute"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">attribute =</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">"price"</span>, <span class="st">""</span>, attribute)))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>minivan_long <span class="sc">%&gt;%</span> </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 12%">
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">resp.id</th>
<th style="text-align: right;">ques</th>
<th style="text-align: right;">alt</th>
<th style="text-align: left;">carpool</th>
<th style="text-align: right;">seat</th>
<th style="text-align: left;">cargo</th>
<th style="text-align: left;">eng</th>
<th style="text-align: right;">choice</th>
<th style="text-align: right;">attribute</th>
<th style="text-align: right;">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">2ft</td>
<td style="text-align: left;">gas</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">3ft</td>
<td style="text-align: left;">hyb</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">30</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">3ft</td>
<td style="text-align: left;">gas</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">30</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">2ft</td>
<td style="text-align: left;">gas</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">30</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">3ft</td>
<td style="text-align: left;">gas</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">2ft</td>
<td style="text-align: left;">elec</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">3ft</td>
<td style="text-align: left;">gas</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">3ft</td>
<td style="text-align: left;">elec</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">30</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">2ft</td>
<td style="text-align: left;">elec</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">40</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">3ft</td>
<td style="text-align: left;">elec</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">40</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape the price data from wide to long format</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>price_long <span class="ot">&lt;-</span> minivan_data <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"price"</span>),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"product"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_prefix =</span> <span class="st">"price"</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"price"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">product =</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">"price"</span>, <span class="st">""</span>, product)))</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>price_long <span class="sc">%&gt;%</span> </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 12%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">resp.id</th>
<th style="text-align: right;">ques</th>
<th style="text-align: right;">alt</th>
<th style="text-align: left;">carpool</th>
<th style="text-align: right;">seat</th>
<th style="text-align: left;">cargo</th>
<th style="text-align: left;">eng</th>
<th style="text-align: right;">choice</th>
<th style="text-align: right;">product</th>
<th style="text-align: right;">price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">2ft</td>
<td style="text-align: left;">gas</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">3ft</td>
<td style="text-align: left;">hyb</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">30</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">3ft</td>
<td style="text-align: left;">gas</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">30</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">2ft</td>
<td style="text-align: left;">gas</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">30</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">3ft</td>
<td style="text-align: left;">gas</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">2ft</td>
<td style="text-align: left;">elec</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">3ft</td>
<td style="text-align: left;">gas</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">3ft</td>
<td style="text-align: left;">elec</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">30</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">2ft</td>
<td style="text-align: left;">elec</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">40</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">3ft</td>
<td style="text-align: left;">elec</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">40</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure all necessary columns are of the same type before reshaping</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>minivan_data <span class="ot">&lt;-</span> minivan_data <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">carpool =</span> <span class="fu">as.character</span>(carpool),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">seat =</span> <span class="fu">as.character</span>(seat),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">cargo =</span> <span class="fu">as.character</span>(cargo),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">eng =</span> <span class="fu">as.character</span>(eng),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">price =</span> <span class="fu">as.character</span>(price))</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape the data from wide to long format</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>minivan_long <span class="ot">&lt;-</span> minivan_data <span class="sc">%&gt;%</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(carpool, seat, cargo, eng, price),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"attribute"</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"id_alt"</span>, resp.id, alt, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> attribute, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>id_alt) <span class="sc">%&gt;%</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>minivan_long <span class="ot">&lt;-</span> minivan_long <span class="sc">%&gt;%</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_option1 =</span> <span class="fu">as.integer</span>(alt <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">is_option2 =</span> <span class="fu">as.integer</span>(alt <span class="sc">==</span> <span class="dv">2</span>),</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">is_option3 =</span> <span class="fu">as.integer</span>(alt <span class="sc">==</span> <span class="dv">3</span>))</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>minivan_long <span class="ot">&lt;-</span> minivan_long <span class="sc">%&gt;%</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">carpool =</span> <span class="fu">as.factor</span>(carpool),</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">cargo =</span> <span class="fu">as.factor</span>(cargo),</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">eng =</span> <span class="fu">as.factor</span>(eng))</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>minivan_long <span class="ot">&lt;-</span> minivan_long <span class="sc">%&gt;%</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(carpool, cargo, eng), as.character)) <span class="sc">%&gt;%</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> carpool, <span class="at">values_from =</span> carpool, <span class="at">values_fn =</span> length, <span class="at">values_fill =</span> <span class="dv">0</span>, <span class="at">names_prefix =</span> <span class="st">"carpool_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> cargo, <span class="at">values_from =</span> cargo, <span class="at">values_fn =</span> length, <span class="at">values_fill =</span> <span class="dv">0</span>, <span class="at">names_prefix =</span> <span class="st">"cargo_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> eng, <span class="at">values_from =</span> eng, <span class="at">values_fn =</span> length, <span class="at">values_fill =</span> <span class="dv">0</span>, <span class="at">names_prefix =</span> <span class="st">"eng_"</span>)</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>minivan_long <span class="ot">&lt;-</span> minivan_long <span class="sc">%&gt;%</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(is_option1, is_option2, is_option3, seat, price), as.numeric))</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>minivan_long <span class="ot">&lt;-</span> minivan_long <span class="sc">%&gt;%</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">choice =</span> <span class="fu">as.numeric</span>(choice))</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>feature_names <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"carpool_|cargo_|eng_|is_option|seat|price"</span>, <span class="fu">names</span>(minivan_long), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>num_features <span class="ot">&lt;-</span> <span class="fu">length</span>(feature_names)</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>minivan_long <span class="sc">%&gt;%</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 5%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 5%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">resp.id</th>
<th style="text-align: right;">ques</th>
<th style="text-align: right;">alt</th>
<th style="text-align: right;">choice</th>
<th style="text-align: right;">seat</th>
<th style="text-align: right;">price</th>
<th style="text-align: right;">is_option1</th>
<th style="text-align: right;">is_option2</th>
<th style="text-align: right;">is_option3</th>
<th style="text-align: right;">carpool_yes</th>
<th style="text-align: right;">carpool_no</th>
<th style="text-align: right;">cargo_2ft</th>
<th style="text-align: right;">cargo_3ft</th>
<th style="text-align: right;">eng_gas</th>
<th style="text-align: right;">eng_hyb</th>
<th style="text-align: right;">eng_elec</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This code will ensure the dataset is structured correctly for your MNL model analysis, adhering strictly to the specified requirements.</p>
<p><br><br></p>
</section>
<section id="i-will-now-code-the-log-likelihood-function-which-is-crucial-for-estimating-the-parameters-of-the-model.-this-function-will-be-used-to-quantify-the-fit-of-the-model-to-the-observed-minivan-data-facilitating-the-optimization-process." class="level3">
<h3 class="anchored" data-anchor-id="i-will-now-code-the-log-likelihood-function-which-is-crucial-for-estimating-the-parameters-of-the-model.-this-function-will-be-used-to-quantify-the-fit-of-the-model-to-the-observed-minivan-data-facilitating-the-optimization-process.">I will now code the log-likelihood function, which is crucial for estimating the parameters of the model. This function will be used to quantify the fit of the model to the observed minivan data, facilitating the optimization process.</h3>
</section>
<section id="next-i-will-utilize-the-optim-function-in-r-to-determine-the-maximum-likelihood-estimates-mles-for-the-parameters.-the-results-will-provide-estimates-for-the-intercepts-of-the-minivan-options-and-the-coefficients-for-the-variables-such-as-carpool-seat-cargo-engine-and-price.-the-coefficients-will-indicate-the-direction-and-magnitude-of-the-impact-of-each-variable-on-the-likelihood-of-choosing-a-particular-minivan-option." class="level3">
<h3 class="anchored" data-anchor-id="next-i-will-utilize-the-optim-function-in-r-to-determine-the-maximum-likelihood-estimates-mles-for-the-parameters.-the-results-will-provide-estimates-for-the-intercepts-of-the-minivan-options-and-the-coefficients-for-the-variables-such-as-carpool-seat-cargo-engine-and-price.-the-coefficients-will-indicate-the-direction-and-magnitude-of-the-impact-of-each-variable-on-the-likelihood-of-choosing-a-particular-minivan-option.">Next, I will utilize the optim() function in R to determine the Maximum Likelihood Estimates (MLEs) for the parameters. The results will provide estimates for the intercepts of the minivan options and the coefficients for the variables such as ‘carpool’, ‘seat’, ‘cargo’, ‘engine’, and ‘price’. The coefficients will indicate the direction and magnitude of the impact of each variable on the likelihood of choosing a particular minivan option.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the log-likelihood function for the MNL model with debugging</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>log_likelihood_mnl <span class="ot">&lt;-</span> <span class="cf">function</span>(beta, data) {</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(data[, feature_names])</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  utility <span class="ot">&lt;-</span> X <span class="sc">%*%</span> beta</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  exp_utility <span class="ot">&lt;-</span> <span class="fu">exp</span>(utility)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Debugging: Check for infinite or NA values</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.infinite</span>(exp_utility)) <span class="sc">||</span> <span class="fu">any</span>(<span class="fu">is.na</span>(exp_utility))) {</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"Infinite or NA values in exp_utility"</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(exp_utility)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">Inf</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  sum_exp_utility <span class="ot">&lt;-</span> <span class="fu">ave</span>(exp_utility, data<span class="sc">$</span>resp.id, <span class="at">FUN =</span> sum)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  probabilities <span class="ot">&lt;-</span> exp_utility <span class="sc">/</span> sum_exp_utility</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate log-likelihood</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  log_likelihood <span class="ot">&lt;-</span> <span class="fu">sum</span>(data<span class="sc">$</span>choice <span class="sc">*</span> <span class="fu">log</span>(probabilities <span class="sc">+</span> <span class="fl">1e-10</span>))</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Debugging: Check for infinite or NA values in log_likelihood</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.infinite</span>(log_likelihood)) <span class="sc">||</span> <span class="fu">any</span>(<span class="fu">is.na</span>(log_likelihood))) {</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"Infinite or NA values in log_likelihood"</span>)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(log_likelihood)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">Inf</span>)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="sc">-</span>log_likelihood)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial beta values (adjust the length according to the number of parameters)</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>beta_initial <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fl">0.1</span>, num_features)  <span class="co"># Adjust length according to the number of parameters</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimization to find the best beta values (MLE)</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>opt_result <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">par =</span> beta_initial, <span class="at">fn =</span> log_likelihood_mnl, <span class="at">data =</span> minivan_long, <span class="at">method =</span> <span class="st">"BFGS"</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">trace =</span> <span class="dv">1</span>, <span class="at">REPORT =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br><br></p>
</section>
<section id="results" class="level3">
<h3 class="anchored" data-anchor-id="results">Results</h3>
</section>
<section id="i-will-interpret-the-coefficients-to-identify-which-features-are-more-preferred-by-consumers." class="level3">
<h3 class="anchored" data-anchor-id="i-will-interpret-the-coefficients-to-identify-which-features-are-more-preferred-by-consumers.">I will interpret the coefficients to identify which features are more preferred by consumers.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>coefficients <span class="ot">&lt;-</span> opt_result<span class="sc">$</span>par</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(coefficients) <span class="ot">&lt;-</span> feature_names</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>coefficients_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Feature =</span> <span class="fu">names</span>(coefficients),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Coefficient =</span> coefficients,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>coefficients_df <span class="sc">%&gt;%</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">rownames&lt;-</span><span class="st">`</span>(<span class="cn">NULL</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Feature</th>
<th style="text-align: right;">Coefficient</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">seat</td>
<td style="text-align: right;">-0.0874294</td>
</tr>
<tr class="even">
<td style="text-align: left;">price</td>
<td style="text-align: right;">-0.0969298</td>
</tr>
<tr class="odd">
<td style="text-align: left;">is_option1</td>
<td style="text-align: right;">0.0811159</td>
</tr>
<tr class="even">
<td style="text-align: left;">is_option2</td>
<td style="text-align: right;">0.1029107</td>
</tr>
<tr class="odd">
<td style="text-align: left;">is_option3</td>
<td style="text-align: right;">0.1154118</td>
</tr>
<tr class="even">
<td style="text-align: left;">carpool_yes</td>
<td style="text-align: right;">0.1000000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">carpool_no</td>
<td style="text-align: right;">0.1000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">cargo_2ft</td>
<td style="text-align: right;">-0.0271381</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cargo_3ft</td>
<td style="text-align: right;">0.2271381</td>
</tr>
<tr class="even">
<td style="text-align: left;">eng_gas</td>
<td style="text-align: right;">0.5269276</td>
</tr>
<tr class="odd">
<td style="text-align: left;">eng_hyb</td>
<td style="text-align: right;">0.1154607</td>
</tr>
<tr class="even">
<td style="text-align: left;">eng_elec</td>
<td style="text-align: right;">-0.3428712</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="coefficients-interpretation" class="level3">
<h3 class="anchored" data-anchor-id="coefficients-interpretation">Coefficients Interpretation</h3>
<ul>
<li>seat (-0.0874294): Each additional seat decreases the utility of the minivan by 0.087. This means that consumers slightly prefer minivans with fewer seats.</li>
<li>price (-0.0969298): An increase in price decreases the utility of the minivan by 0.097. This indicates that higher prices reduce the likelihood of a minivan being chosen.</li>
<li>is_option1 (0.0811159), is_option2 (0.1029107), is_option3 (0.1154118): These coefficients represent the base utility of the respective minivan options. Positive values indicate that these options have an inherent utility, making them more likely to be chosen compared to a baseline (which is not explicitly shown here). Among the three, option 3 has the highest base utility.</li>
<li>carpool_yes (0.1000000): Having the carpool feature increases the utility of the minivan by 0.100. This suggests that consumers prefer minivans with the carpool feature.</li>
<li>carpool_no (0.1000000): This seems to have the same coefficient as carpool_yes. This likely indicates an issue, as typically we would not include both yes/no dummy variables simultaneously. We should have either carpool_yes or carpool_no, but not both.</li>
<li>cargo_2ft (-0.0271381): Having a 2ft cargo space decreases the utility of the minivan by 0.027. This suggests a slight preference against minivans with 2ft cargo space.</li>
<li>cargo_3ft (0.2271381): Having a 3ft cargo space increases the utility of the minivan by 0.227. This indicates a strong preference for minivans with 3ft cargo space over those with other cargo space options.</li>
<li>eng_gas (0.5269276): Having a gas engine increases the utility of the minivan by 0.527. This suggests a strong preference for minivans with gas engines.</li>
<li>eng_hyb (0.1154607): Having a hybrid engine increases the utility of the minivan by 0.115. This indicates a moderate preference for minivans with hybrid engines.</li>
<li>eng_elec (-0.3428712): Having an electric engine decreases the utility of the minivan by 0.343. This indicates a strong preference against minivans with electric engines compared to other engine types.</li>
</ul>
</section>
<section id="summary" class="level3">
<h3 class="anchored" data-anchor-id="summary">Summary</h3>
<section id="most-preferred-features" class="level4">
<h4 class="anchored" data-anchor-id="most-preferred-features">Most Preferred Features:</h4>
<ul>
<li>Gas Engine: Strong positive impact on utility.</li>
<li>3ft Cargo Space: Significant positive impact on utility.</li>
<li>Hybrid Engine: Moderate positive impact on utility.</li>
<li>Carpool Feature: Positive impact on utility.</li>
<li>Option 3: Highest base utility among the options.</li>
</ul>
</section>
<section id="least-preferred-features" class="level4">
<h4 class="anchored" data-anchor-id="least-preferred-features">Least Preferred Features:</h4>
<ul>
<li>Electric Engine: Strong negative impact on utility.</li>
<li>Higher Price: Negative impact on utility.</li>
<li>Additional Seats: Slight negative impact on utility.</li>
<li>2ft Cargo Space: Slight negative impact on utility.</li>
</ul>
<p>These coefficients help in understanding consumer preferences for different features of minivans. Features with positive coefficients are preferred by consumers, while those with negative coefficients are less preferred. The magnitude of the coefficients indicates the strength of these preferences.</p>
<p><br><br></p>
</section>
</section>
<section id="i-will-use-the-price-coefficient-as-a-dollar-per-util-conversion-factor-to-calculate-the-monetary-value-of-additional-cargo-space.-specifically-i-will-quantify-the-dollar-value-of-having-3ft-of-cargo-space-compared-to-2ft-leveraging-the-price-coefficient-to-translate-the-utility-gained-from-extra-cargo-space-into-a-monetary-equivalent." class="level3">
<h3 class="anchored" data-anchor-id="i-will-use-the-price-coefficient-as-a-dollar-per-util-conversion-factor-to-calculate-the-monetary-value-of-additional-cargo-space.-specifically-i-will-quantify-the-dollar-value-of-having-3ft-of-cargo-space-compared-to-2ft-leveraging-the-price-coefficient-to-translate-the-utility-gained-from-extra-cargo-space-into-a-monetary-equivalent.">I will use the price coefficient as a dollar-per-util conversion factor to calculate the monetary value of additional cargo space. Specifically, I will quantify the dollar value of having 3ft of cargo space compared to 2ft, leveraging the price coefficient to translate the utility gained from extra cargo space into a monetary equivalent.</h3>
</section>
<section id="monetary-measure-of-cargo-space-value" class="level3">
<h3 class="anchored" data-anchor-id="monetary-measure-of-cargo-space-value">Monetary Measure of Cargo Space Value</h3>
<p>We can use the estimated price coefficient as a dollar-per-util conversion factor to calculate the dollar benefit between 3ft of cargo space and 2ft of cargo space. This provides a per-unit monetary measure of the cargo space value.</p>
<p>Step 1: Establish the Util Difference - The utility difference between 3ft cargo space and 2ft cargo space is calculated as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>util_difference <span class="ot">&lt;-</span> coefficients[<span class="st">"cargo_3ft"</span>] <span class="sc">-</span> coefficients[<span class="st">"cargo_2ft"</span>]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>util_difference</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>cargo_3ft 
0.2542763 </code></pre>
</div>
</div>
<p>Step 2: Use the Estimated Price Coefficient - The estimated price coefficient, β price, is -0.0969298. This coefficient can be interpreted as the change in utility for each dollar increase in price. Thus, the dollar-per-util conversion factor is the inverse of this coefficient:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>beta_price <span class="ot">&lt;-</span> coefficients[<span class="st">"price"</span>]</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>dollar_per_util <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">abs</span>(beta_price)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>dollar_per_util</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   price 
10.31674 </code></pre>
</div>
</div>
<p>Step 3: Calculate the Dollar Benefit - The dollar benefit of the difference in utility between 3ft cargo space and 2ft cargo space can be calculated as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>dollar_benefit <span class="ot">&lt;-</span> util_difference <span class="sc">*</span> dollar_per_util</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>dollar_benefit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>cargo_3ft 
 2.623303 </code></pre>
</div>
</div>
<section id="conclusion" class="level4">
<h4 class="anchored" data-anchor-id="conclusion">Conclusion</h4>
<p>The dollar benefit of approximately $2.62 represents the per-unit monetary measure of the value of 3ft cargo space over 2ft cargo space. This quantifies the premium that consumers might be willing to pay for a minivan with 3ft of cargo space compared to one with 2ft, based on their utility differences derived from the coefficients.</p>
<p><br><br></p>
</section>
</section>
<section id="finally-i-will-fit-a-multinomial-logistic-regression-model-to-predict-the-market-shares-of-each-minivan-in-a-defined-market-consisting-of-six-different-minivan-configurations.-this-model-will-use-the-coefficients-from-the-previous-estimations-to-calculate-the-likelihood-of-each-minivan-being-chosen-by-consumers-based-on-their-attributes-and-pricing.-the-predicted-market-shares-will-provide-insights-into-consumer-preferences-and-competitive-positioning-within-the-minivan-market." class="level3">
<h3 class="anchored" data-anchor-id="finally-i-will-fit-a-multinomial-logistic-regression-model-to-predict-the-market-shares-of-each-minivan-in-a-defined-market-consisting-of-six-different-minivan-configurations.-this-model-will-use-the-coefficients-from-the-previous-estimations-to-calculate-the-likelihood-of-each-minivan-being-chosen-by-consumers-based-on-their-attributes-and-pricing.-the-predicted-market-shares-will-provide-insights-into-consumer-preferences-and-competitive-positioning-within-the-minivan-market.">Finally, I will fit a multinomial logistic regression model to predict the market shares of each minivan in a defined market consisting of six different minivan configurations. This model will use the coefficients from the previous estimations to calculate the likelihood of each minivan being chosen by consumers, based on their attributes and pricing. The predicted market shares will provide insights into consumer preferences and competitive positioning within the minivan market.</h3>
<p><br></p>
<table class="table">
<thead>
<tr class="header">
<th>Minivan</th>
<th>Seats</th>
<th>Cargo</th>
<th>Engine</th>
<th>Price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>7</td>
<td>2</td>
<td>Hyb</td>
<td>30</td>
</tr>
<tr class="even">
<td>B</td>
<td>6</td>
<td>2</td>
<td>Gas</td>
<td>30</td>
</tr>
<tr class="odd">
<td>C</td>
<td>8</td>
<td>2</td>
<td>Gas</td>
<td>30</td>
</tr>
<tr class="even">
<td>D</td>
<td>7</td>
<td>3</td>
<td>Gas</td>
<td>40</td>
</tr>
<tr class="odd">
<td>E</td>
<td>6</td>
<td>2</td>
<td>Elec</td>
<td>40</td>
</tr>
<tr class="even">
<td>F</td>
<td>7</td>
<td>2</td>
<td>Hyb</td>
<td>35</td>
</tr>
</tbody>
</table>
</section>
<section id="fit-a-multinomial-logistic-regression-model" class="level3">
<h3 class="anchored" data-anchor-id="fit-a-multinomial-logistic-regression-model">1. Fit a multinomial logistic regression model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the multinomial logit model</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>mnl_model <span class="ot">&lt;-</span> <span class="fu">multinom</span>(choice <span class="sc">~</span> price <span class="sc">+</span> cargo_2ft <span class="sc">+</span> cargo_3ft <span class="sc">+</span> eng_gas <span class="sc">+</span> eng_hyb <span class="sc">+</span> eng_elec <span class="sc">+</span> seat <span class="sc">+</span> is_option1 <span class="sc">+</span> is_option2 <span class="sc">+</span> is_option3,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> minivan_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># weights:  12 (11 variable)
initial  value 6238.324625 
iter  10 value 5071.228895
final  value 5053.932676 
converged</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of the model</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mnl_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
multinom(formula = choice ~ price + cargo_2ft + cargo_3ft + eng_gas + 
    eng_hyb + eng_elec + seat + is_option1 + is_option2 + is_option3, 
    data = minivan_long)

Coefficients:
                Values   Std. Err.
(Intercept)  2.6692453 0.138951089
price       -0.1584517 0.006189041
cargo_2ft    1.1165787 0.072695667
cargo_3ft    1.5526666 0.074483015
eng_gas      1.6156809 0.059947977
eng_hyb      0.8617126 0.057318456
eng_elec     0.1918518 0.056611585
seat        -0.1506701 0.029657883
is_option1   0.8601286 0.057547491
is_option2   0.8941925 0.057817393
is_option3   0.9149241 0.057370833

Residual Deviance: 10107.87 
AIC: 10123.87 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the coefficients and standard errors</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>coefficients <span class="ot">&lt;-</span> <span class="fu">summary</span>(mnl_model)<span class="sc">$</span>coefficients</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>standard_errors <span class="ot">&lt;-</span> <span class="fu">summary</span>(mnl_model)<span class="sc">$</span>standard.errors</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate z-values</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>z_values <span class="ot">&lt;-</span> coefficients <span class="sc">/</span> standard_errors</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate two-tailed p-values from the z-values</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>p_values <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(z_values)))</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>p_values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)       price   cargo_2ft   cargo_3ft     eng_gas     eng_hyb 
0.00000e+00 0.00000e+00 0.00000e+00 0.00000e+00 0.00000e+00 0.00000e+00 
   eng_elec        seat  is_option1  is_option2  is_option3 
7.01702e-04 3.76897e-07 0.00000e+00 0.00000e+00 0.00000e+00 </code></pre>
</div>
</div>
<section id="model-summary" class="level4">
<h4 class="anchored" data-anchor-id="model-summary">Model Summary</h4>
<ul>
<li>The model predicts choice based on independent variables: price, cargo_2ft, cargo_3ft, eng_gas, eng_hyb, eng_elec, seat, and dummy variables for minivan options (is_option1, is_option2, is_option3).</li>
<li>Residual Deviance: 10107.85 <br> The residual deviance can be assessed against the degrees of freedom to determine goodness-of-fit.</li>
<li>Akaike Information Criterion (AIC): 10125.85 <br> – AIC provides a measure for comparing models, where lower values are generally preferred.</li>
</ul>
</section>
<section id="statistical-significance" class="level4">
<h4 class="anchored" data-anchor-id="statistical-significance">Statistical Significance</h4>
<ul>
<li>All variables except eng_elec, and seat show p-values significantly smaller than 0.05, indicating that they are statistically significant predictors of choice.</li>
</ul>
</section>
<section id="interpretation" class="level4">
<h4 class="anchored" data-anchor-id="interpretation">Interpretation</h4>
<p>Given the statistical significance of nearly all coefficients and assuming that the residuals analysis, diagnostics, and validation of model assumptions hold up to scrutiny, this model appears to be robust for the data at hand. The sign and size of the coefficients suggest practical implications on how price, cargo space, engine type, number of seats, and minivan options influence choice probabilities.</p>
</section>
</section>
<section id="calculate-market-shares-with-assumed-data" class="level3">
<h3 class="anchored" data-anchor-id="calculate-market-shares-with-assumed-data">2. Calculate Market Shares with Assumed Data:</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the market minivans as per the provided table</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>market_minivans <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">seat =</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">7</span>, <span class="dv">6</span>, <span class="dv">7</span>),</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">cargo =</span> <span class="fu">c</span>(<span class="st">"2ft"</span>, <span class="st">"2ft"</span>, <span class="st">"2ft"</span>, <span class="st">"3ft"</span>, <span class="st">"2ft"</span>, <span class="st">"2ft"</span>),</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">eng =</span> <span class="fu">c</span>(<span class="st">"hyb"</span>, <span class="st">"gas"</span>, <span class="st">"gas"</span>, <span class="st">"gas"</span>, <span class="st">"elec"</span>, <span class="st">"hyb"</span>),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">price =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">30</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">40</span>, <span class="dv">35</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>market_minivans <span class="ot">&lt;-</span> market_minivans <span class="sc">%&gt;%</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cargo =</span> <span class="fu">as.factor</span>(cargo),</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">eng =</span> <span class="fu">as.factor</span>(eng))</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>market_minivans <span class="ot">&lt;-</span> market_minivans <span class="sc">%&gt;%</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">cargo_2ft =</span> <span class="fu">as.integer</span>(cargo <span class="sc">==</span> <span class="st">"2ft"</span>),</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">cargo_3ft =</span> <span class="fu">as.integer</span>(cargo <span class="sc">==</span> <span class="st">"3ft"</span>),</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">eng_gas =</span> <span class="fu">as.integer</span>(eng <span class="sc">==</span> <span class="st">"gas"</span>),</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">eng_hyb =</span> <span class="fu">as.integer</span>(eng <span class="sc">==</span> <span class="st">"hyb"</span>),</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">eng_elec =</span> <span class="fu">as.integer</span>(eng <span class="sc">==</span> <span class="st">"elec"</span>)</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>market_minivans <span class="ot">&lt;-</span> market_minivans <span class="sc">%&gt;%</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_option1 =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_option2 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_option3 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_option4 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_option5 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_option6 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>market_minivans <span class="ot">&lt;-</span> market_minivans <span class="sc">%&gt;%</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(price, cargo_2ft, cargo_3ft, eng_gas, eng_hyb, eng_elec, seat, is_option1, is_option2, is_option3, is_option4, is_option5, is_option6)</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to predict choice probabilities and ensure matrix output</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>predict_probs <span class="ot">&lt;-</span> <span class="cf">function</span>(model, data) {</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>  probs <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, data, <span class="at">type =</span> <span class="st">"probs"</span>)</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.vector</span>(probs)) {</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>    probs <span class="ot">&lt;-</span> <span class="fu">matrix</span>(probs, <span class="at">nrow =</span> <span class="fu">length</span>(probs) <span class="sc">/</span> <span class="dv">6</span>, <span class="at">ncol =</span> <span class="dv">6</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(probs)</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>predicted_probs_market <span class="ot">&lt;-</span> <span class="fu">predict_probs</span>(mnl_model, market_minivans)</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the market shares by taking column means of the predicted probabilities</span></span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.matrix</span>(predicted_probs_market)) {</span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>  market_shares <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(predicted_probs_market)</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Market Shares for Minivan Products (raw):"</span>)</span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(market_shares)</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>  market_shares_normalized <span class="ot">&lt;-</span> market_shares <span class="sc">/</span> <span class="fu">sum</span>(market_shares) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Market Shares for Minivan Products (normalized):"</span>)</span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(market_shares_normalized)</span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"predicted_probs_market is not a matrix."</span>)</span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>minivan_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Minivan A"</span>, <span class="st">"Minivan B"</span>, <span class="st">"Minivan C"</span>, <span class="st">"Minivan D"</span>, <span class="st">"Minivan E"</span>, <span class="st">"Minivan F"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>market_shares_normalized <span class="ot">&lt;-</span> market_shares <span class="sc">/</span> <span class="fu">sum</span>(market_shares) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>market_shares_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Minivan =</span> minivan_names, <span class="at">MarketShare =</span> market_shares_normalized) <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(MarketShare)) <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MarketShare =</span> <span class="fu">percent</span>(MarketShare <span class="sc">/</span> <span class="dv">100</span>)) </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>market_shares_df <span class="sc">%&gt;%</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Minivan</th>
<th style="text-align: left;">MarketShare</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Minivan B</td>
<td style="text-align: left;">32.7%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Minivan C</td>
<td style="text-align: left;">29.4%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Minivan A</td>
<td style="text-align: left;">21.2%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Minivan D</td>
<td style="text-align: left;">8.7%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Minivan F</td>
<td style="text-align: left;">6.2%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Minivan E</td>
<td style="text-align: left;">1.8%</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="market-shares-for-minivan-products" class="level3">
<h3 class="anchored" data-anchor-id="market-shares-for-minivan-products">Market Shares for Minivan Products</h3>
<ul>
<li>Minivan B (Seats: 6, Cargo: 2ft, Engine: Gas, Price: 30): 32.7%</li>
<li>Minivan C (Seats: 8, Cargo: 2ft, Engine: Gas, Price: 30): 29.4%</li>
<li>Minivan A (Seats: 7, Cargo: 2ft, Engine: Hybrid, Price: 30): 21.2%</li>
<li>Minivan D (Seats: 7, Cargo: 3ft, Engine: Gas, Price: 40): 8.7%</li>
<li>Minivan F (Seats: 7, Cargo: 2ft, Engine: Hybrid, Price: 35): 6.2%</li>
<li>Minivan E (Seats: 6, Cargo: 2ft, Engine: Electric, Price: 40): 1.8%</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>market_shares_df <span class="ot">&lt;-</span> market_shares_df <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Rank =</span> <span class="fu">rank</span>(<span class="sc">-</span>MarketShare)) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Color =</span> <span class="fu">case_when</span>(</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    Rank <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"lightgreen"</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    Rank <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"lightgray"</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"lightcoral"</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>market_shares_df <span class="sc">%&gt;%</span> </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Minivan, <span class="sc">-</span>MarketShare), <span class="at">y =</span> MarketShare, <span class="at">fill =</span> Color)) <span class="sc">+</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.1f%%"</span>, MarketShare)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_identity</span>() <span class="sc">+</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Market Shares for Minivan Products"</span>, <span class="at">x =</span> <span class="st">"Minivan"</span>, <span class="at">y =</span> <span class="st">"Market Share (%)"</span>) <span class="sc">+</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw3_questions_2_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interpretation-1" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-1">Interpretation</h3>
<section id="most-preferred-minivans" class="level4">
<h4 class="anchored" data-anchor-id="most-preferred-minivans">Most Preferred Minivans:</h4>
<ul>
<li>Minivan B (32.7%): This minivan has the highest market share, indicating it is the most preferred option. It has 6 seats, 2ft cargo space, a gas engine, and is priced at 30.</li>
<li>Minivan C (29.4%): This minivan has the second-highest market share. It has 8 seats, 2ft cargo space, a gas engine, and is also priced at 30.</li>
</ul>
</section>
<section id="moderately-preferred-minivans" class="level4">
<h4 class="anchored" data-anchor-id="moderately-preferred-minivans">Moderately Preferred Minivans:</h4>
<ul>
<li>Minivan A (21.2%): This minivan is preferred by a significant portion of the market. It has 7 seats, 2ft cargo space, a hybrid engine, and is priced at 30.</li>
<li>Minivan D (8.7%): This minivan has 7 seats, 3ft cargo space, a gas engine, and is priced at 40. The higher price and larger cargo space seem to affect its market share negatively compared to Minivans A, B, and C.</li>
</ul>
</section>
<section id="least-preferred-minivans" class="level4">
<h4 class="anchored" data-anchor-id="least-preferred-minivans">Least Preferred Minivans:</h4>
<ul>
<li>Minivan F (6.2%): This minivan has 7 seats, 2ft cargo space, a hybrid engine, and is priced at 35. The higher price compared to Minivan A may contribute to its lower market share.</li>
<li>Minivan E (1.8%): This minivan has the lowest market share. It has 6 seats, 2ft cargo space, an electric engine, and is priced at 40. The higher price and the less preferred electric engine type contribute to its lower market share.</li>
</ul>
</section>
<section id="summary-1" class="level4">
<h4 class="anchored" data-anchor-id="summary-1">Summary</h4>
<ul>
<li>Price Sensitivity: Higher prices generally reduce the market share, as seen with Minivans D, E, and F.</li>
<li>Engine Preference: Gas engines are highly preferred, contributing to the higher market shares of Minivans B and C.</li>
<li>Seat Configuration: Minivans with a balanced seat configuration (6-8 seats) are more preferred.</li>
<li>Cargo Space: 2ft cargo space is more preferred compared to 3ft cargo space in this specific dataset.</li>
</ul>
<p><br><br></p>
</section>
</section>
<section id="final-thoughts-and-conclusion" class="level3">
<h3 class="anchored" data-anchor-id="final-thoughts-and-conclusion">Final Thoughts and Conclusion</h3>
<ul>
<li>In this project, we employed a Multinomial Logistic Regression model to analyze consumer preferences and predict market shares within the minivan market. Here are the key takeaways and conclusions from our analysis:</li>
</ul>
<section id="model-summary-1" class="level4">
<h4 class="anchored" data-anchor-id="model-summary-1">Model Summary:</h4>
<ul>
<li>The coefficients from the multinomial logistic regression indicate significant predictors of consumer choice.</li>
<li>Price has a strong negative effect on the probability of choosing a minivan, indicating that consumers are highly price-sensitive.</li>
<li>The presence of features such as cargo space, engine type, and the number of seats also play significant roles in influencing consumer choices.</li>
<li>The base utilities of different minivan options (is_option1, is_option2, is_option3) were also found to be significant, highlighting inherent preferences for certain minivan configurations.</li>
</ul>
</section>
<section id="market-share-analysis" class="level4">
<h4 class="anchored" data-anchor-id="market-share-analysis">Market Share Analysis:</h4>
<p>Using the specified minivan configurations, the predicted market shares were as follows:</p>
<ul>
<li>Minivan B: 32.7%</li>
<li>Minivan C: 29.4%</li>
<li>Minivan A: 21.2%</li>
<li>Minivan D: 8.7%</li>
<li>Minivan F: 6.2%</li>
<li>Minivan E: 1.8%</li>
</ul>
<p>This distribution suggests that Minivan B is the most preferred choice among consumers, followed by Minivan C and Minivan A. Minivan E has the lowest market share, indicating a strong preference against its configuration (electric engine, higher price).</p>
</section>
<section id="impact-of-feature-preferences" class="level4">
<h4 class="anchored" data-anchor-id="impact-of-feature-preferences">Impact of Feature Preferences:</h4>
<ul>
<li>Engine Type: Gas engines are highly preferred, contributing to the higher market shares of Minivans B and C.</li>
<li>Cargo Space: 3ft cargo space is more preferred compared to 2ft cargo space, as seen with the preference for Minivan D despite its higher price.</li>
<li>Price Sensitivity: Higher prices generally reduce market share, as evidenced by the lower shares for Minivans D, E, and F, which are priced higher than other options.</li>
</ul>
</section>
<section id="conclusion-1" class="level4">
<h4 class="anchored" data-anchor-id="conclusion-1">Conclusion</h4>
<ul>
<li>The analysis demonstrates the high price sensitivity of consumers in the minivan market. Price, along with key features such as cargo space and engine type, significantly influence consumer preferences and choice probabilities. These findings highlight the importance of strategic pricing and feature offerings in maintaining competitive advantage in the minivan market.</li>
</ul>
</section>
<section id="recommendations" class="level4">
<h4 class="anchored" data-anchor-id="recommendations">Recommendations:</h4>
<ul>
<li>Price Sensitivity Considerations: Companies should carefully consider the impact of price changes on consumer demand. Even moderate increases can lead to substantial shifts in market shares.</li>
<li>Feature and Engine Preferences: Enhancing desirable features such as gas engines and optimal cargo space can positively influence consumer choices and help retain market share.</li>
<li>Market Simulations for Strategic Decisions: Regularly performing market simulations can help predict consumer behavior in response to pricing and other strategic changes. This provides valuable insights for decision-making and maintaining competitive advantage.</li>
</ul>
</section>
<section id="by-leveraging-advanced-analytical-techniques-like-multinomial-logistic-regression-and-market-simulations-businesses-can-better-understand-consumer-preferences-and-optimize-their-product-offerings-and-pricing-strategies-to-maximize-market-share-and-profitability." class="level4">
<h4 class="anchored" data-anchor-id="by-leveraging-advanced-analytical-techniques-like-multinomial-logistic-regression-and-market-simulations-businesses-can-better-understand-consumer-preferences-and-optimize-their-product-offerings-and-pricing-strategies-to-maximize-market-share-and-profitability.">By leveraging advanced analytical techniques like Multinomial Logistic Regression and market simulations, businesses can better understand consumer preferences and optimize their product offerings and pricing strategies to maximize market share and profitability.</h4>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>